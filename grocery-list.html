<!DOCTYPE html>
<html>
<head>
	<title>Grocery List</title>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<style type="text/css">
		li 
{			margin: 5px;
		}
		.checked {
			text-decoration: line-through;
		}
		.no-decoration {
			list-style: none;
		}
		h4 {
			margin-left: 2em;
		}
	</style>
</head>
<body>

	<div id="groceries">
		<h3>Groceries</h3>
		<ul id="form"></ul>		
	</div>

	<div id="calculator">
		<h3>Calculator</h3>
		<form>
			<input type="number" name="number" id="number">
			<button id="button">Submit</button>
		</form>
		<div id="total-costs">
			<h4>Total Cost</h4>
			<ul class="no-decoration" id="results">
		</div>
		<div id="individual-prices">
			<h4>Prices</h4>
			<ul class="no-decoration" id="prices"></ul>
		</div>
	</div>

	<div id="recipes">
		<h3>Recipes</h3>
		<ol id="links"></ol>		
	</div>

	<div><a href="https://docs.google.com/spreadsheets/d/1wf4Vxknpg5n7VHFPKD3lo7Fd55WerkPAJJaPTelYdJc/edit?usp=sharing">Base Spreadsheet</a></div>

	<div>
		<button id="clear" type="button">Clear Local Storage</button>
	</div>

<script type="text/javascript">
	// CHANGE THIS
	const items = [
	 	{
	 		"item": "Bob's Red Mill gluten free flour",
	 		"state": false,
	 	},
	 	{
	 		"item": "tums",
	 		"state": false,
	 	},
	 	{
	 		"item": "eggs 2 dozen",
	 		"state": false,
	 	},
	 	{
	 		"item": "broccoli ",
	 		"state": false,
	 	},
	 	{
	 		"item": "soy sauce ",
	 		"state": false,
	 	},
	 	{
	 		"item": "panko breadcrumbs",
	 		"state": false,
	 	},
	 	{
	 		"item": "garlic cloves",
	 		"state": false,
	 	},
	 	{
	 		"item": "fresh ginger",
	 		"state": false,
	 	},
	]



	// CHANGE THIS
	const recipes = [
		{ 
			"url": "https://workweeklunch.com/recipe/orange-baked-chicken-copycat/", 
			"name": "orange chicken", 
			"notes": "", 
		},
		{ 
			"url": "#", 
			"name": "chicken, broccoli, potato sheet pan", 
			"notes": "",
		},
		{ 
			"url": "#", 
			"name": "recipe 3", 
			"notes": "",
		},
	]

	const form = document.getElementById('form');

		// adds elements to localStorage
	let storedItems, storedRecipes;

	// debugger

	if(!localStorage.getItem("items")) {
		localStorage.setItem("items", JSON.stringify(items));
		storedItems = JSON.parse(localStorage.getItem("items"));
	} else {
		storedItems = JSON.parse(localStorage.getItem("items"));
	}
	
	if(!localStorage.getItem("recipes")) {
		localStorage.setItem("recipes", JSON.stringify(recipes));
		storedRecipes = JSON.parse(localStorage.getItem("recipes"));
	} else {
		storedRecipes = JSON.parse(localStorage.getItem("recipes"));
	}

	// adds each grocery item to a bulleted list
	let itemId = 0;
	storedItems.forEach(item => {
		const newGrocery = document.createElement('li');
		newGrocery.setAttribute("id", itemId);
		itemId+= 1;

		newGrocery.textContent = item.item;
		form.appendChild(newGrocery);

		// adds strikethrough if already checked
		if(item.state === true) {
			newGrocery.classList.add("checked");
		}

		// toggles strikethrough on repeat clicks
		newGrocery.addEventListener('click', function(e) {
			newGrocery.classList.toggle("checked");
			if(storedItems[e.target.id].state === true) {
				storedItems[e.target.id].state = false;
				updateLocalStorage("items", storedItems);
			} else {
				storedItems[e.target.id].state = true;
				updateLocalStorage("items", storedItems);
			}
		});

	});

	// adds each recipe to a bulleted list
	const links = document.getElementById('links');
	let linkIndex = 0;

	storedRecipes.forEach(recipe => {
		// console.log(recipe);
		const link = document.createElement('li');
		link.setAttribute("id", linkIndex);
		linkIndex+= 1;
		const url = document.createElement('a');
		url.setAttribute('href', `${recipe.url}`);
		url.textContent = recipe.name;
		link.appendChild(url);
		links.appendChild(link);

		if(recipe.notes) {
			// console.log("note available");
			const noteContainer = document.createElement('ul');
			const note = document.createElement('li');
			note.textContent = recipe.notes;
			noteContainer.appendChild(note);
			link.appendChild(noteContainer);
		}
	});

	const input = document.getElementById('number');
	const button = document.getElementById('button');
	const prices = document.getElementById('prices');

	let math = []

	// input and display prices
	button.addEventListener('click', function(e) {
		e.preventDefault();

		if(input.value) {
			math.push(input.value);
			math = math.map(Number);

			const entry = document.createElement('li');
			entry.textContent = `$${input.value}`;
			prices.appendChild(entry);
			input.value = "";

			// add prices together and display
			const results = document.getElementById('results');
			const sums = (accumulator, currentValue) => accumulator + currentValue;
			results.textContent = `$${math.reduce(sums).toFixed(2)}`;

		}
	});

	// clears localStorage when clicked
	clear.addEventListener('click', function(e) {
		e.preventDefault();

		localStorage.clear();
	});

	function addToLocalStorage(name, elements) {
		localStorage.setItem(name, JSON.stringify(elements));
	}

	function updateLocalStorage(name, elements) {
		localStorage.setItem(name, JSON.stringify(elements));
	}

</script>
</body>
</html>